var LoadExternalImage=pc.createScript("loadExternalImage");LoadExternalImage.attributes.add("imageUrl",{type:"string"}),LoadExternalImage.prototype.initialize=function(){var e=this;this.app.loader.getHandler("texture").crossOrigin="anonymous";var a=new pc.Asset("myTexture","texture",{url:this.imageUrl});this.app.assets.add(a),a.on("error",function(e){console.log(e)}),a.on("load",function(a){var t=e.entity.model.material.clone();t.diffuseMap=a.resource,t.update(),e.entity.model.material=t}),this.app.assets.load(a)},LoadExternalImage.prototype.update=function(e){};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity"}),FirstPersonMovement.attributes.add("power",{type:"number"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;this.app.mouse.on("mousemove",this._onMouseMove,this),this.lastTouchPoint=new pc.Vec2;var e=this.app.touch;e&&(e.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),e.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),e.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),e.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this)),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,o=this.app,s=this.camera.forward,i=this.camera.right,r=0,n=0;o.keyboard.isPressed(pc.KEY_A)&&(r-=i.x,n-=i.z),o.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),o.keyboard.isPressed(pc.KEY_W)&&(r+=s.x,n+=s.z),o.keyboard.isPressed(pc.KEY_S)&&(r-=s.x,n-=s.z),0!==r&&0!==n&&(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype.onTouchStart=function(e){this.MOVE_SCALE=1,this.direction.copy(this.camera.forward),this.direction.y=0,this.direction.scale(this.MOVE_SCALE),this.entity.rigidbody&&this.entity.rigidbody.applyImpulse(this.direction)},FirstPersonMovement.prototype.onTouchMove=function(e){var t=e.touches[0],o=t.x-this.lastTouchPoint.x,s=t.y-this.lastTouchPoint.y;this.eulers.x-=this.lookSpeed*o,this.eulers.y-=this.lookSpeed*s,this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0),this.lastTouchPoint.set(t.x,t.y),console.log("touch move")},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)},FirstPersonMovement.prototype.onTouchEnd=function(e){e.event.preventDefault()},FirstPersonMovement.prototype.updateFromScreen=function(e){this.cameraEntity.camera.screenToWorld(e.x,e.y,5,this.pos),this.entity.setPosition(this.pos)};var MultitouchInput=pc.createScript("multitouchInput");MultitouchInput.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),MultitouchInput.attributes.add("lineColor",{type:"rgba",title:"Line Color"}),MultitouchInput.DEFAULT_DISTANCE_FROM_CAMERA=4,MultitouchInput.prototype.initialize=function(){var t=this.app.touch;t&&(t.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),t.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this)),this.activeTouches=[],this.freeTouches=[]},MultitouchInput.prototype.update=function(t){for(var o=1;o<this.activeTouches.length;o+=1){var i=this.activeTouches[o-1],e=this.activeTouches[o];this.app.renderLine(i.position,e.position,this.lineColor)}},MultitouchInput.prototype.addTouchWorldPosition=function(t){var o=null;(o=this.freeTouches.length>0?this.freeTouches.pop():{id:0,position:new pc.Vec3}).id=t.id,this.cameraEntity.camera.screenToWorld(t.x,t.y,MultitouchInput.DEFAULT_DISTANCE_FROM_CAMERA,o.position),this.activeTouches.push(o)},MultitouchInput.prototype.updateTouchWorldPosition=function(t){for(var o=0;o<this.activeTouches.length;o+=1){var i=this.activeTouches[o];if(t.id==i.id)return void this.cameraEntity.camera.screenToWorld(t.x,t.y,MultitouchInput.DEFAULT_DISTANCE_FROM_CAMERA,i.position)}},MultitouchInput.prototype.removeTouchWorldPosition=function(t){var o=-1,i=0;for(i=0;i<this.activeTouches.length;i+=1){var e=this.activeTouches[i];if(t.id==e.id){o=i;break}}if(-1!=o){var u=this.activeTouches.splice(o,1);for(i=0;i<u.length;i+=1)this.freeTouches.push(u[i])}},MultitouchInput.prototype.onTouchStart=function(t){for(var o=t.changedTouches,i=0;i<o.length;i+=1)this.addTouchWorldPosition(o[i])},MultitouchInput.prototype.onTouchMove=function(t){for(var o=t.changedTouches,i=0;i<o.length;i+=1)this.updateTouchWorldPosition(o[i])},MultitouchInput.prototype.onTouchEnd=function(t){for(var o=t.changedTouches,i=0;i<o.length;i+=1)this.removeTouchWorldPosition(o[i])},MultitouchInput.prototype.onTouchCancel=function(t){for(var o=t.changedTouches,i=0;i<o.length;i+=1)this.removeTouchWorldPosition(o[i])};var LoadExternalImageMesh=pc.createScript("loadExternalImageMesh");LoadExternalImageMesh.prototype.initialize=function(){},LoadExternalImageMesh.prototype.update=function(e){};